<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meilin Starwell | Character Companion</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Uncial+Antiqua&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-portrait" data-lightbox="img/portrait.png">
                    <img src="img/portrait.png" alt="Meilin Starwell" />
                </div>
                <h1 class="sidebar-title">Meilin Starwell</h1>
                <p class="sidebar-subtitle">Dockside Apothecary</p>
            </div>
            <nav class="sidebar-nav">
                <a href="#overview" class="nav-link active" data-page="overview">
                    <span class="nav-icon"><i data-lucide="user"></i></span>
                    <span class="nav-text">Character Overview</span>
                </a>
                <a href="#rumors" class="nav-link" data-page="rumors">
                    <span class="nav-icon"><i data-lucide="message-circle"></i></span>
                    <span class="nav-text">Rumors</span>
                </a>
                <a href="#backstory" class="nav-link" data-page="backstory">
                    <span class="nav-icon"><i data-lucide="book-open"></i></span>
                    <span class="nav-text">Backstory</span>
                </a>
                <a href="#dmtools" class="nav-link" data-page="dmtools">
                    <span class="nav-icon"><i data-lucide="dices"></i></span>
                    <span class="nav-text">DM Tools</span>
                </a>
                <a href="#medicine" class="nav-link" data-page="medicine">
                    <span class="nav-icon"><i data-lucide="leaf"></i></span>
                    <span class="nav-text">Herbal Medicine</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <p class="sidebar-quote">If it matters, write it down.</p>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-area">
            <!-- At a Glance Page (DM Quick Reference) -->
            <div class="page active" id="overview-page">
                <!-- Hero Section -->
                <section class="aag-hero" style="background-image: url('img/banner.png');" data-lightbox="img/banner.png" title="Click to view full image">
                    <div class="aag-hero-content">
                        <h1 class="aag-name" id="aag-name">Meilin Starwell</h1>
                        <p class="aag-tagline" id="aag-tagline"></p>
                        <blockquote class="aag-quote" id="aag-quote"></blockquote>
                    </div>
                </section>

                <!-- Core Concept Section -->
                <section class="aag-section aag-core">
                    <div class="aag-thesis-box" id="aag-thesis"></div>
                    <div class="aag-core-details">
                        <div class="aag-detail" id="aag-trouble">
                            <span class="aag-detail-label">Trouble:</span>
                            <span class="aag-detail-text"></span>
                        </div>
                        <div class="aag-detail" id="aag-defining">
                            <span class="aag-detail-label">Defining Moment:</span>
                            <span class="aag-detail-text"></span>
                        </div>
                    </div>
                </section>

                <!-- 30-Second Summary -->
                <section class="aag-section aag-summary">
                    <h2 class="aag-section-title">The Story</h2>
                    <p class="aag-summary-text" id="aag-summary"></p>
                </section>

                <!-- Cards Row: Drives, Boundaries, Shared Anchor -->
                <section class="aag-section aag-cards-row">
                    <div class="aag-card aag-drives">
                        <h3 class="aag-card-title">Drives</h3>
                        <ul class="aag-card-list" id="aag-drives-list"></ul>
                    </div>
                    <div class="aag-card aag-boundaries">
                        <h3 class="aag-card-title">Boundaries</h3>
                        <ul class="aag-card-list" id="aag-boundaries-list"></ul>
                    </div>
                    <div class="aag-card aag-glue">
                        <h3 class="aag-card-title">Shared Anchor</h3>
                        <ul class="aag-card-list" id="aag-glue-list"></ul>
                    </div>
                </section>

                <!-- Secrets Section -->
                <section class="aag-section aag-secrets">
                    <h2 class="aag-section-title">Secrets &amp; Mysteries</h2>
                    <div class="aag-secrets-grid" id="aag-secrets-grid"></div>
                </section>

                <!-- Quick Links -->
                <section class="aag-section aag-quicklinks">
                    <h2 class="aag-section-title">Explore More</h2>
                    <div class="aag-links-row">
                        <a href="#backstory" class="aag-link-card" data-navigate="backstory">
                            <span class="aag-link-icon"><i data-lucide="book-open"></i></span>
                            <span class="aag-link-title">Backstory</span>
                            <span class="aag-link-count" id="aag-chapters-count">12 chapters</span>
                        </a>
                        <a href="#dmtools" class="aag-link-card" data-navigate="dmtools" data-section="relationships">
                            <span class="aag-link-icon"><i data-lucide="link"></i></span>
                            <span class="aag-link-title">Relationships</span>
                            <span class="aag-link-count" id="aag-relationships-count">8 connections</span>
                        </a>
                        <a href="#dmtools" class="aag-link-card" data-navigate="dmtools" data-section="knives">
                            <span class="aag-link-icon"><i data-lucide="sword"></i></span>
                            <span class="aag-link-title">Knives</span>
                            <span class="aag-link-count" id="aag-knives-count">5 hooks for the DM</span>
                        </a>
                    </div>
                </section>
            </div>

            <!-- Rumors Page (Player-Facing) -->
            <div class="page" id="rumors-page">
                <!-- Hero with Key Art -->
                <header class="rumors-hero" data-lightbox="img/key_art.png">
                    <img src="img/key_art.png" alt="Meilin Starwell" class="rumors-hero-image" />
                </header>

                <!-- Divider -->
                <hr class="rumors-divider" />

                <!-- Section Title -->
                <h2 class="rumors-section-title">What They Say</h2>

                <!-- Main Rumors Layout -->
                <div class="rumors-layout">
                    <!-- Rumors Sidebar -->
                    <aside class="rumors-sidebar">
                        <div class="rumors-list" id="rumors-list">
                            <!-- Populated by JS -->
                        </div>
                    </aside>

                    <!-- Character Gallery -->
                    <main class="rumors-gallery">
                        <div class="rumors-gallery-single" data-lightbox="img/scene.png">
                            <img src="img/scene.png" alt="Meilin at work" />
                        </div>
                    </main>
                </div>

                <!-- Divider -->
                <hr class="rumors-divider" />

                <!-- Visual Details -->
                <section class="rumors-details">
                    <h2 class="rumors-details-title">What You Notice</h2>
                    <div class="rumors-details-grid">
                        <div class="rumors-detail-card">
                            <span class="rumors-detail-icon"><i data-lucide="eye"></i></span>
                            <h3>The Look</h3>
                            <p>Waxed-canvas cloak, labeled vials, small notebook, satchel strapped down tight.</p>
                        </div>
                        <div class="rumors-detail-card">
                            <span class="rumors-detail-icon"><i data-lucide="hand"></i></span>
                            <h3>The Hands</h3>
                            <p>Ink-stained fingers that never quite wash clean. Work-worn, chemical-burn marks like a constellation.</p>
                        </div>
                        <div class="rumors-detail-card">
                            <span class="rumors-detail-icon"><i data-lucide="book-open-text"></i></span>
                            <h3>The Read</h3>
                            <p>Kind, but watchful. You get the sense she's already figured you out.</p>
                        </div>
                    </div>
                </section>

                <!-- Divider -->
                <hr class="rumors-divider" />

                <!-- Character Turnaround -->
                <section class="rumors-views">
                    <div class="rumors-turnaround" data-lightbox="img/turnaround.png">
                        <img src="img/turnaround.png" alt="Meilin Starwell - Character Turnaround" />
                    </div>
                </section>

                </div>

            <!-- Medicine Page -->
            <div class="page" id="medicine-page">
                <header class="page-header page-header-hero" style="background-image: url('img/scene.png');">
                    <div class="page-header-overlay">
                        <h1 class="page-title">Meilin's Apothecary</h1>
                        <p class="page-subtitle">Herbal Medicine Quick Reference</p>
                    </div>
                </header>

                <!-- Quick Rules Reference (Collapsible) -->
                <section class="quick-rules">
                    <details>
                        <summary class="rules-toggle">
                            <span class="rules-icon"><i data-lucide="scroll"></i></span>
                            Quick Rules Reference
                        </summary>
                        <div class="rules-content" id="rules-content">
                            <!-- Will be populated by JS -->
                        </div>
                    </details>
                </section>

                <!-- How to Harvest (Collapsible) -->
                <section class="quick-rules">
                    <details>
                        <summary class="rules-toggle">
                            <span class="rules-icon"><i data-lucide="axe"></i></span>
                            How to Harvest
                        </summary>
                        <div class="rules-content" id="harvesting-content">
                            <!-- Will be populated by JS -->
                        </div>
                    </details>
                </section>

                <!-- Tab Navigation -->
                <nav class="tab-nav">
                    <button class="tab-btn active" data-tab="medicines">Medicines</button>
                    <button class="tab-btn" data-tab="ingredients">Ingredients</button>
                    <button class="tab-btn" data-tab="potionrules">Rules</button>
                </nav>

                <!-- Main Content -->
                <main class="main-content">
                    <!-- Medicines Grid -->
                    <div class="tab-content active" id="medicines-tab">
                        <!-- Search and Filters -->
                        <section class="search-section">
                            <div class="filter-controls">
                                <div class="filter-group">
                                    <label for="category-filter">Category:</label>
                                    <select id="category-filter">
                                        <option value="all">All Categories</option>
                                        <option value="Augmenting">Augmenting</option>
                                        <option value="Curative">Curative</option>
                                        <option value="Fortifying">Fortifying</option>
                                        <option value="Restorative">Restorative</option>
                                        <option value="Special">Special</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="difficulty-filter">Difficulty:</label>
                                    <select id="difficulty-filter">
                                        <option value="all">All Difficulties</option>
                                        <option value="1">â˜… (DC 10)</option>
                                        <option value="2">â˜…â˜… (DC 15)</option>
                                        <option value="3">â˜…â˜…â˜… (DC 20)</option>
                                        <option value="4">â˜…â˜…â˜…â˜… (DC 25)</option>
                                        <option value="5">â˜…â˜…â˜…â˜…â˜… (DC 28)</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="ingredient-type-filter">Ingredients:</label>
                                    <select id="ingredient-type-filter">
                                        <option value="all">All Types</option>
                                        <option value="flora">Flora Only</option>
                                        <option value="creature">Creature Only</option>
                                    </select>
                                </div>
                            </div>
                            <div class="search-bar">
                                <input type="text" id="search-input" placeholder="Search medicines..." autocomplete="off">
                                <button class="clear-search" id="clear-search" title="Clear search">Ã—</button>
                            </div>
                        </section>
                        <div class="medicine-count" id="medicine-count"></div>
                        <div class="medicine-grid" id="medicine-grid">
                            <!-- Medicine cards will be populated by JS -->
                        </div>
                    </div>

                    <!-- Ingredients Reference -->
                    <div class="tab-content" id="ingredients-tab">
                        <div class="ingredients-section" id="ingredients-section">
                            <!-- Ingredient tables will be populated by JS -->
                        </div>
                    </div>

                    <!-- Potion Rules Reference -->
                    <div class="tab-content" id="potionrules-tab">
                        <div class="potion-rules-section" id="potion-rules-section">
                            <!-- Potion rules will be populated by JS -->
                        </div>
                    </div>
                </main>

                <!-- Medicine Detail Modal -->
                <div class="modal-overlay" id="modal-overlay">
                    <div class="modal" id="medicine-modal">
                        <button class="modal-close" id="modal-close">Ã—</button>
                        <div class="modal-content" id="modal-content">
                            <!-- Modal content populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Footer (Medicine page only) -->
                <footer class="footer">
                    <p class="footer-credit">Based on the Alchemy Almanac system</p>
                </footer>
            </div>

            <!-- Backstory Page -->
            <div class="page" id="backstory-page">
                <header class="page-header page-header-hero" style="background-image: url('img/key_art.png');">
                    <div class="page-header-overlay">
                        <h1 class="page-title">The Story of Meilin Starwell</h1>
                        <p class="page-subtitle">A dock-born apothecary who learned that cures are politics</p>
                    </div>
                </header>

                <!-- Backstory Content (Single Scrollable Page) -->
                <main class="backstory-content">
                    <!-- Backstory Chapters -->
                    <div class="backstory-enhanced" id="backstory-enhanced">
                        <div class="loading-spinner">Loading backstory...</div>
                    </div>

                    <!-- Vignettes Section (After Backstory) -->
                    <section class="vignettes-section" id="vignettes-section">
                        <div class="section-divider">
                            <span class="divider-text">After the Backstory</span>
                        </div>
                        <div class="vignettes-intro">
                            <h2 class="vignettes-title">Vignettes</h2>
                            <p class="vignettes-note">These vignettes take place <strong>after</strong> Meilin's backstory, during her time at the Astral Bazaar. Each captures a small moment that reveals her skills, habits, and way of seeing the world.</p>
                        </div>
                        <div class="vignettes-grid" id="vignettes-grid">
                            <div class="loading-spinner">Loading vignettes...</div>
                        </div>
                    </section>
                </main>

                <!-- Vignette Detail Modal -->
                <div class="modal-overlay" id="vignette-modal-overlay">
                    <div class="modal vignette-modal">
                        <button class="modal-close" id="vignette-modal-close">Ã—</button>
                        <div class="modal-content" id="vignette-modal-content">
                            <!-- Vignette content populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- DM Tools Page -->
            <div class="page" id="dmtools-page">
                <header class="page-header">
                    <h1 class="page-title">DM Tools</h1>
                    <p class="page-subtitle">Hooks, relationships, and handles for running Meilin</p>
                </header>

                <!-- DM Tools Tab Navigation -->
                <nav class="dmtools-tabs">
                    <button class="dmtools-tab active" data-dmtab="relationships">
                        <span class="dmtools-tab-icon"><i data-lucide="link"></i></span>
                        <span class="dmtools-tab-text">Relationships</span>
                    </button>
                    <button class="dmtools-tab" data-dmtab="knives">
                        <span class="dmtools-tab-icon"><i data-lucide="sword"></i></span>
                        <span class="dmtools-tab-text">Knives</span>
                    </button>
                    <button class="dmtools-tab" data-dmtab="mindersand">
                        <span class="dmtools-tab-icon"><i data-lucide="flask-conical"></i></span>
                        <span class="dmtools-tab-text">Mindersand</span>
                    </button>
                    <button class="dmtools-tab" data-dmtab="medica">
                        <span class="dmtools-tab-icon"><i data-lucide="heart-pulse"></i></span>
                        <span class="dmtools-tab-text">The Medica</span>
                    </button>
                </nav>

                <main class="dmtools-content">
                    <!-- Relationships Tab Panel -->
                    <section class="dmtools-panel active" id="relationships-panel">
                        <div class="dmtools-panel-header">
                            <h2 class="dmtools-panel-title">Relationships</h2>
                            <p class="dmtools-panel-subtitle">A visual map of Meilin's connections, tensions, and the pressure points between them.</p>
                        </div>
                        <div class="relationships-map" id="relationships-map">
                            <div class="loading-spinner">Loading relationships...</div>
                        </div>
                    </section>

                    <!-- Knives Tab Panel -->
                    <section class="dmtools-panel" id="knives-panel">
                        <div class="dmtools-panel-header">
                            <h2 class="dmtools-panel-title">Knives</h2>
                            <p class="dmtools-panel-subtitle"><strong>Knives</strong> are specific, actionable things the DM can use to create drama. Each one is a handle to pull Meilin into the story.</p>
                        </div>
                        <div class="knives-grid" id="knives-grid">
                            <div class="loading-spinner">Loading knives...</div>
                        </div>
                    </section>

                    <!-- Mindersand Tab Panel -->
                    <section class="dmtools-panel" id="mindersand-panel">
                        <div class="dmtools-panel-header">
                            <h2 class="dmtools-panel-title">Mindersand Reference</h2>
                            <p class="dmtools-panel-subtitle">The contraband powder at the heart of Meilin's story. Use this reference to describe its effects, trace its routes, and build encounters around it.</p>
                        </div>
                        <div class="mindersand-content" id="mindersand-content">
                            <div class="loading-spinner">Loading mindersand data...</div>
                        </div>
                    </section>

                    <!-- Medica Tab Panel -->
                    <section class="dmtools-panel" id="medica-panel">
                        <div class="dmtools-panel-header">
                            <h2 class="dmtools-panel-title">The Medica</h2>
                            <p class="dmtools-panel-subtitle">Use this reference to understand guild mechanics, rank progression, and how to integrate the Medica into your campaign.</p>
                        </div>
                        <div class="medica-content" id="medica-content">
                            <div class="loading-spinner">Loading Medica data...</div>
                        </div>
                    </section>
                </main>

                <!-- NPC Detail Modal -->
                <div class="modal-overlay" id="npc-modal-overlay">
                    <div class="modal npc-modal">
                        <button class="modal-close" id="npc-modal-close">Ã—</button>
                        <div class="modal-content" id="npc-modal-content">
                            <!-- NPC content populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Knife Detail Modal -->
                <div class="modal-overlay" id="knife-modal-overlay">
                    <div class="modal knife-modal">
                        <button class="modal-close" id="knife-modal-close">Ã—</button>
                        <div class="modal-content" id="knife-modal-content">
                            <!-- Knife content populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Passkey Modal -->
    <div class="modal-overlay" id="passkey-modal-overlay">
        <div class="modal passkey-modal">
            <div class="passkey-content">
                <h2 class="passkey-title">ðŸ”’ Meilin's Companion</h2>
                <p class="passkey-subtitle">Enter the passkey to access this reference.</p>
                <form id="passkey-form">
                    <input type="password" id="passkey-input" class="passkey-input" placeholder="Enter passkey..." autocomplete="off">
                    <p class="passkey-error" id="passkey-error"></p>
                    <div class="passkey-buttons">
                        <button type="submit" class="passkey-submit">Unlock</button>
                    </div>
                </form>
                <p class="passkey-hint">Hint: The code for mindersand in Smith's Coster's ledger.</p>
            </div>
        </div>
    </div>

    <!-- Global Image Lightbox Modal -->
    <div class="lightbox-overlay" id="global-lightbox">
        <button class="lightbox-close" id="lightbox-close">&times;</button>
        <img class="lightbox-image" id="lightbox-image" src="" alt="Enlarged view" />
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Scripts -->
    <script src="js/app.js"></script>
    
    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>
